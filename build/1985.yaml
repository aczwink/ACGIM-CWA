steps:
  #addons
  - type: RepackArchive
    sourceLocation: cwa_installer
    source:
      type: Archive
      name: CWA.exe
      pbo: .rsrc/0/RCDATA/CWA\ADDONS\6G30.PBO.XZ
    exclude: [config.bin, stringtable.csv]
    include:
      - source: source
        path: AddOns/6G30/config.cpp
    targetPboName: 6G30

  - type: RepackArchive
    sourceLocation: cwa_installer
    source:
      type: Archive
      name: CWA.exe
      pbo: .rsrc/0/RCDATA/CWA\ADDONS\ABOX.PBO.XZ
    exclude: [config.bin, stringtable.csv]
    include:
      - source: source
        path: AddOns/ABox/config.cpp
    targetPboName: ABox


  - type: CopyFiles
    source: resources
    files: AddOns/*.pbo #TODO: check this, I think these are just copies of the original addon files but without the config.cpp/config.bin/stringtable.csv. This could be done with a unpack-delete config-repack step

  #bin
  - type: CompileConfig
    source: source
    sourceFile: Bin/Config.cpp
    targetFolder: Bin

  - type: CompileConfig
    source: source
    sourceFile: Bin/Resource.cpp
    targetFolder: Bin

  - type: CopyFiles
    source: source
    files: Bin/STRINGTABLE.CSV


  #dta
  - type: ImportFiles
    source: addons
    sources:
      - type: Archive
        name: FFUR_85_Patch_1.05.exe
        pbos:
          - "@ffsx85/addons/Noe.pbo"
          - "@ffsx85/addons/SLX_Grass.pbo"
          - "@ffsx85/addons/SLX_Grass_CWC_Islands.pbo"
        files:
          - Noe/noe.wrp
          - SLX_Grass_CWC_Islands/Abel.wrp
          - SLX_Grass_CWC_Islands/cain.wrp
          - SLX_Grass_CWC_Islands/Eden.wrp

  - type: CopyFiles
    source: resources
    files: Dta/*.pbo #TODO: these should be packed instead of copied

  - type: PackArchive
    source: source
    source_folder: Scripts
    target_folder: Dta

  - type: PackArchive
    source: resources
    source_folder: Dta/sjc_files
    target_folder: Dta

  - type: PackArchive
    source: resources
    source_folder: Dta/SJC_Scripts
    target_folder: Dta

  #misc
  - type: CopyFiles
    source: source
    files: [LICENSE, README.md, Start.bat, Start Windowed.bat, Used Addons.md]

  - type: Create7zArchive